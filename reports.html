<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>تقارير ثانوية الصحافة</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { font-family: 'Tajawal', sans-serif; background: #f4f7f6; padding: 20px; }
        .card { background: white; padding: 25px; border-radius: 15px; max-width: 1000px; margin: auto; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        .header { text-align: center; color: #8e44ad; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #eee; padding: 10px; text-align: center; }
        th { background: #34495e; color: white; }
    </style>
</head>
<body>
    <div class="card">
        <h1 class="header">التقرير الإحصائي العام</h1>
        <div style="text-align:center; background:#f9f9f9; padding:15px; border-radius:10px;">
            من: <input type="date" id="s"> إلى: <input type="date" id="e">
            <button onclick="calc()" style="padding:8px 25px; cursor:pointer; background:#8e44ad; color:white; border:none; border-radius:5px;">تحليل البيانات</button>
        </div>
        <table>
            <thead>
                <tr>
                    <th>المعلم</th>
                    <th>أيام الحضور</th>
                    <th>أيام الغياب</th>
                    <th>إجمالي دقائق الخروج المؤقت</th>
                </tr>
            </thead>
            <tbody id="res"></tbody>
        </table>
    </div>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAuOkZYWzjBTpuWdeibeEWC0tVR87byEEw",
            authDomain: "hader-system.firebaseapp.com",
            databaseURL: "https://hader-system-default-rtdb.firebaseio.com/", 
            projectId: "hader-system",
            appId: "1:1039709774940:web:078351fe5cb90593473299"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        function calc() {
            const start = new Date(document.getElementById('s').value);
            const end = new Date(document.getElementById('e').value);
            database.ref('attendance').once('value', s => {
                const all = s.val();
                let stats = {};
                for(let date in all) {
                    const p = date.split('-');
                    const d = new Date(p[2], p[1]-1, p[0]);
                    if(d >= start && d <= end) {
                        for(let id in all[date]) {
                            const r = all[date][id];
                            if(!stats[id]) stats[id] = { name: r.name, p:0, a:0, om:0 };
                            if(r.inStatus === "غائب") stats[id].a++;
                            else { stats[id].p++; stats[id].om += Number(r.outDuringDay || 0); }
                        }
                    }
                }
                document.getElementById('res').innerHTML = Object.keys(stats).map(id => `
                    <tr><td>${stats[id].name}</td><td>${stats[id].p}</td><td>${stats[id].a}</td><td>${stats[id].om}</td></tr>
                `).join('');
            });
        }
    </script>
</body>
</html>