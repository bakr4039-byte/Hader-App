<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>إدارة ثانوية الصحافة</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { font-family: 'Tajawal', sans-serif; background: #f4f7f6; padding: 20px; }
        .nav { display: flex; justify-content: center; gap: 15px; margin-bottom: 20px; }
        .nav a, .btn-abs { padding: 10px 25px; border-radius: 8px; color: white; text-decoration: none; font-weight: bold; border: none; cursor: pointer; }
        .title-sec { text-align: center; margin-bottom: 25px; }
        .date-box { background: white; padding: 10px 30px; border-radius: 30px; display: inline-block; box-shadow: 0 2px 10px rgba(0,0,0,0.05); color: #3498db; }
        table { width: 100%; border-collapse: collapse; background: white; border-radius: 12px; overflow: hidden; }
        th { background: #34495e; color: white; padding: 15px; }
        td { padding: 15px; border-bottom: 1px solid #eee; text-align: center; }
    </style>
</head>
<body>
    <div class="nav">
        <a href="links.html" style="background:#34495e;">الروابط</a>
        <a href="reports.html" style="background:#8e44ad;">التقارير</a>
        <button class="btn-abs" style="background:#e74c3c;" onclick="recordAbsenceAll()">تسجيل غياب المتأخرين</button>
    </div>

    <div class="title-sec">
        <h1><i class="fas fa-school"></i> ثانوية الصحافة</h1>
        <div class="date-box" id="fullDate"></div>
    </div>

    <table>
        <thead>
            <tr>
                <th>المعلم</th>
                <th>حضور</th>
                <th>تأخير (د)</th>
                <th>انصراف</th>
                <th>خروج مؤقت (د)</th>
                <th>الحالة</th>
            </tr>
        </thead>
        <tbody id="adminTable"></tbody>
    </table>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAuOkZYWzjBTpuWdeibeEWC0tVR87byEEw",
            authDomain: "hader-system.firebaseapp.com",
            databaseURL: "https://hader-system-default-rtdb.firebaseio.com/", 
            projectId: "hader-system",
            storageBucket: "hader-system.firebasestorage.app",
            messagingSenderId: "1039709774940",
            appId: "1:1039709774940:web:078351fe5cb90593473299"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const todayKey = new Date().toLocaleDateString('en-GB').replace(/\//g, '-');

        document.getElementById('fullDate').innerText = new Date().toLocaleDateString('ar-SA', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });

        database.ref('teachers').on('value', tSnap => {
            const teachers = tSnap.val();
            database.ref('attendance/' + todayKey).on('value', aSnap => {
                const att = aSnap.val() || {};
                const body = document.getElementById('adminTable');
                body.innerHTML = "";
                for(let id in teachers) {
                    const a = att[id];
                    body.innerHTML += `<tr>
                        <td>${teachers[id].name}</td>
                        <td>${a?.checkIn || '--:--'}</td>
                        <td style="color:red">${a?.lateMins || 0}</td>
                        <td>${a?.checkOut || '--:--'}</td>
                        <td style="color:#e67e22; font-weight:bold;">${a?.outDuringDay || 0}</td>
                        <td style="color:${a ? '#27ae60' : '#e74c3c'}">${a ? (a.inStatus || 'حاضر') : 'غائب'}</td>
                    </tr>`;
                }
            });
        });

        function recordAbsenceAll() {
            if(!confirm("اعتماد غياب الجميع؟")) return;
            database.ref('teachers').once('value', s => {
                const ts = s.val();
                database.ref('attendance/' + todayKey).once('value', as => {
                    const att = as.val() || {};
                    for(let id in ts) if(!att[id]) database.ref(`attendance/${todayKey}/${id}`).set({ name: ts[id].name, inStatus: "غائب", checkIn: "غائب" });
                });
            });
        }
    </script>
</body>
</html>