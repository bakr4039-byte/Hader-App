<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>إدارة ثانوية الصحافة</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { font-family: 'Tajawal', sans-serif; background: #f4f7f6; padding: 20px; }
        .nav { display: flex; justify-content: center; gap: 15px; margin-bottom: 25px; }
        .btn-nav { padding: 10px 25px; border-radius: 8px; color: white; text-decoration: none; font-weight: bold; border: none; cursor: pointer; transition: 0.3s; }
        h1 { text-align: center; color: #2c3e50; }
        table { width: 100%; border-collapse: collapse; background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        th { background: #34495e; color: white; padding: 15px; }
        td { padding: 15px; border-bottom: 1px solid #eee; text-align: center; }
        .out-badge { color: #e67e22; font-weight: bold; }
    </style>
</head>
<body>
    <div class="nav">
        <a href="links.html" class="btn-nav" style="background:#34495e;">الروابط</a>
        <a href="reports.html" class="btn-nav" style="background:#8e44ad;">التقارير</a>
        <button class="btn-nav" style="background:#e74c3c;" onclick="recordAbsenceAll()">تسجيل غياب المتأخرين</button>
    </div>
    <h1><i class="fas fa-desktop"></i> لوحة إدارة ثانوية الصحافة</h1>
    <table>
        <thead>
            <tr>
                <th>المعلم</th>
                <th>حضور</th>
                <th>انصراف</th>
                <th>خروج مؤقت (د)</th>
                <th>الحالة</th>
            </tr>
        </thead>
        <tbody id="adminTable"></tbody>
    </table>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAuOkZYWzjBTpuWdeibeEWC0tVR87byEEw",
            authDomain: "hader-system.firebaseapp.com",
            databaseURL: "https://hader-system-default-rtdb.firebaseio.com/", 
            projectId: "hader-system",
            appId: "1:1039709774940:web:078351fe5cb90593473299"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const today = new Date().toLocaleDateString('en-GB').replace(/\//g, '-');

        database.ref('teachers').on('value', tSnap => {
            const ts = tSnap.val();
            database.ref('attendance/' + today).on('value', aSnap => {
                const att = aSnap.val() || {};
                const body = document.getElementById('adminTable');
                body.innerHTML = "";
                for(let id in ts) {
                    const a = att[id];
                    body.innerHTML += `<tr>
                        <td><strong>${ts[id].name}</strong></td>
                        <td>${a?.checkIn || '--:--'}</td>
                        <td>${a?.checkOut || '--:--'}</td>
                        <td class="out-badge">${a?.outDuringDay || 0}</td>
                        <td style="color:${a ? '#27ae60' : '#e74c3c'}">${a ? (a.inStatus || 'حاضر') : 'غائب'}</td>
                    </tr>`;
                }
            });
        });

        function recordAbsenceAll() {
            if(!confirm("اعتماد غياب جميع من لم يبصم حتى الآن؟")) return;
            database.ref('teachers').once('value', s => {
                const teachers = s.val();
                database.ref('attendance/' + today).once('value', as => {
                    const att = as.val() || {};
                    for(let id in teachers) if(!att[id]) database.ref(`attendance/${today}/${id}`).set({ name: teachers[id].name, inStatus: "غائب", checkIn: "غائب" });
                });
            });
        }
    </script>
</body>
</html>