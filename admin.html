<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>لوحة الإدارة - ثانوية الصحافة</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { font-family: 'Tajawal', sans-serif; background: #f4f7f6; padding: 20px; }
        .header { text-align: center; margin-bottom: 30px; }
        .nav-bar { display: flex; justify-content: center; gap: 15px; margin-bottom: 20px; }
        .btn-link { padding: 10px 25px; border-radius: 8px; color: white; text-decoration: none; font-weight: bold; border: none; cursor: pointer; transition: 0.3s; }
        table { width: 100%; border-collapse: collapse; background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        th { background: #34495e; color: white; padding: 15px; }
        td { padding: 15px; border-bottom: 1px solid #eee; text-align: center; }
        .status-tag { padding: 5px 12px; border-radius: 20px; font-weight: bold; font-size: 13px; }
        .status-present { background: #e8f5e9; color: #2e7d32; }
        .status-absent { background: #ffebee; color: #c62828; }
    </style>
</head>
<body>
    <div class="header">
        <h1><i class="fas fa-desktop"></i> إدارة ثانوية الصحافة</h1>
        <div class="nav-bar">
            <a href="links.html" class="btn-link" style="background:#34495e;">إدارة المعلمين</a>
            <a href="reports.html" class="btn-link" style="background:#8e44ad;">التقارير</a>
            <button class="btn-link" style="background:#e74c3c;" onclick="recordAbsenceAll()">تسجيل غياب الجميع</button>
        </div>
    </div>

    <table>
        <thead>
            <tr>
                <th>المعلم</th>
                <th>وقت الحضور</th>
                <th>وقت الانصراف</th>
                <th>خروج أثناء الدوام (د)</th>
                <th>الحالة</th>
            </tr>
        </thead>
        <tbody id="adminTable"></tbody>
    </table>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAuOkZYWzjBTpuWdeibeEWC0tVR87byEEw",
            authDomain: "hader-system.firebaseapp.com",
            databaseURL: "https://hader-system-default-rtdb.firebaseio.com/", 
            projectId: "hader-system",
            storageBucket: "hader-system.firebasestorage.app",
            messagingSenderId: "1039709774940",
            appId: "1:1039709774940:web:078351fe5cb90593473299"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const todayKey = new Date().toLocaleDateString('en-GB').replace(/\//g, '-');

        database.ref('teachers').on('value', tSnap => {
            const teachers = tSnap.val();
            database.ref('attendance/' + todayKey).on('value', aSnap => {
                const att = aSnap.val() || {};
                const body = document.getElementById('adminTable');
                body.innerHTML = "";
                for(let id in teachers) {
                    const a = att[id];
                    body.innerHTML += `<tr>
                        <td><strong>${teachers[id].name}</strong><br><small>${id}</small></td>
                        <td>${a?.checkIn || '--:--'}</td>
                        <td>${a?.checkOut || '--:--'}</td>
                        <td style="color:#e67e22; font-weight:bold;">${a?.outDuringDay || 0}</td>
                        <td><span class="status-tag ${a ? 'status-present' : 'status-absent'}">${a ? (a.inStatus || 'حاضر') : 'غائب'}</span></td>
                    </tr>`;
                }
            });
        });

        function recordAbsenceAll() {
            if(!confirm("تحويل غير المسجلين لغائب؟")) return;
            database.ref('teachers').once('value', s => {
                const ts = s.val();
                database.ref('attendance/' + todayKey).once('value', as => {
                    const att = as.val() || {};
                    for(let id in ts) if(!att[id]) database.ref(`attendance/${todayKey}/${id}`).set({ name: ts[id].name, inStatus: "غائب", checkIn: "غائب" });
                });
            });
        }
    </script>
</body>
</html>